<html>
<head>
	<style>
	.inputs{
		height: 50px;
		font-size: 20pt;
	}
	.box{
		border: 1px solid black;
		padding: 6px;
		margin: 6px;
		font-family: Arial;
		font-size: 16pt;
		background-color: white;
		cursor: pointer;
	}
	.box:hover{
		background-color: lightblue;
	}
	#images img{
		width: 20%;
		margin: 5px;
		vertical-align: top;
		cursor: pointer;
	}
	#images img:hover{
		margin: 0px;
		border: 5px solid lightblue;
	}
	
	
	.block {
      display: block;
  	  margin-bottom: 10px;
  	  width: 100%;
    }
    #quote {
      background: #ffaaaa;
	  height: 100px;
    }
    #imageurl{
	  background: #aaffaa;
	  height: 100px;
    }
    .button {
      width: 30%;
	  height: 100px;
	  margin-bottom: 50px;
	  margin-right: 20px;
    }
    .mid {
      text-align: center;
    }
    #square {
      //border: 20px #dddddd solid;
	  text-align: center;
	  width: 100%;
	  margin-top: 20px;
	  margin-bottom: 100px;
    }
    #prettyquote {
      width: auto;
	  font-family: Georgia;
	  text-align: center;
	  padding-top: 20px;
	  padding-bottom: 5px;
    }
    .font20 {
	  font-size: 20pt;
	  font-family: Arial;
    }
	</style>
</head>
<body>

<input type="text" class="inputs" id="inputAuthor" value="albert einstein"></input>
<input type="button" class="inputs" id="getQuotes" value="Get Quotes" onclick="getQuotes();"></input>
<input type="button" class="inputs" id="getImages" value="Get Images" onclick="getImages();"></input>
<input id="smallerbutton" class="inputs" type="button" value="Smaller" onclick="smaller();"></input>
<input id="biggerbutton" class="inputs" type="button" value="Bigger" onclick="bigger();"></input>

<div id="quotes"></div>
<div id="images"></div>
<div id="square">
  <div id="prettyquote"></div>
  <img id="outputImage"></img>
</div>

<script>
var square = document.getElementById("square");
w = square.offsetWidth;
h = w;
square.style.height = h + "px";

var prettyquote = document.getElementById("prettyquote");
var landscape = false;

function setPrettyQuoteFontSize(s){
  prettyquote.style.fontSize = s + "pt";
}
var s = 20;
setPrettyQuoteFontSize(s);

var inputAuthor = document.getElementById("inputAuthor");

function resizeImage(){
  outputImage = h - prettyquote.offsetHeight;
  outputImage.style.height = imageheight + "px";
  outputImage.style.width = "auto";
  imagewidth = outputImage.offsetWidth;
  squarewidth = prettyquote.offsetWidth;
  if(landscape && imagewidth > squarewidth){
	outputImage.style.height = "auto";
	imagewidth = squarewidth
	outputImage.style.width = imagewidth + "px";
  }
}

function applyQuote(inputQuote, inputAuthor){
  document.getElementById("quotes").style.display = "none";

  inputQuoteAndAuthor = inputQuote + "\n- " + inputAuthor;
  quoteless = inputQuoteAndAuthor.replace(/\"/g, "");
  quoteparts = quoteless.split("\n");
  authorformatted = quoteparts[1];
  if(authorformatted && !authorformatted.startsWith("- ")){
	authorformatted = "- " + authorformatted;
  }
  quoteformatted = "\"" + quoteparts[0] + "\"<br><br>" + authorformatted;
  prettyquote.innerHTML = quoteformatted;
}

function applyImage(imageUrl){
  document.getElementById("images").style.display = "none";
  
  outputImage.onload = function(){
    landscape = outputImage.width > outputImage.height;
    resizeImage();
  }
  outputImage.setAttribute("src", imageUrl);
}

function smaller(){
  s -= 2;
  setPrettyQuoteFontSize(s);
  resizeImage()
}

function bigger(){
  s += 2;
  setPrettyQuoteFontSize(s);
  resizeImage()
}


function loadXMLDoc(url, f){
	var xmlhttp;
	if(window.XMLHttpRequest){
		//code for IE7+, Firefox, Chrome, Opera, Safari
		xmlhttp = new XMLHttpRequest();
	}else{
		//code for IE6, IE5
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	xmlhttp.onreadystatechange = function(){
		if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
			f(xmlhttp.responseText);
		}
	}
	xmlhttp.open("GET", url, true);
	xmlhttp.send();
}

function el(id){
	return document.getElementById(id);
}

function cl(element, className){
	return element.getElementsByClassName(className)[0];
}

function cls(element, className){
	return element.getElementsByClassName(className);
}

function tn(element, tagName){
	return element.getElementsByTagName(tagName)[0];
}

function tns(element, tagName){
	return element.getElementsByTagName(tagName);
}

function getGoodreadsQuote(quoteElement){
	var quoteAuthorArray = [];
	var raw = cl(cl(quoteElement, "quoteDetails"), "quoteText").innerText;
	raw = raw.replace(/“|”/g, '').split("\n");
	for(var i=0; i<raw.length; i++){
		var rawi = raw[i].trim();
		if(rawi != ""){
			quoteAuthorArray.push(rawi);
		}
	}
	
	if(quoteAuthorArray.length == 3){
		return quoteAuthorArray;
	}else{
		return null;
	}
}

function getGoodreadsQuotes(htmlString){
	var htmlEl = document.createElement("html");
	htmlEl.innerHTML = htmlString;
	var quoteEls = cls(htmlEl, "quote");
	var outputQuotes = el("quotes");
	for(var i=0; i<quoteEls.length; i++){
		var quoteEl = quoteEls[i];
		var quoteArray = getGoodreadsQuote(quoteEl);
		if(quoteArray != null && quoteArray.length == 3){
			var outputQuote = document.createElement("div");
			outputQuote.setAttribute("class", "box");
			outputQuote.setAttribute("onclick", "applyQuote('" + quoteArray[0] + "', '" + quoteArray[2] + "');");
			outputQuote.innerHTML = "<div>" + quoteArray[0] + "</div><div>- " + quoteArray[2] + "<div>";
			outputQuotes.appendChild(outputQuote);
		}
	}
}

function getGoodreadsAuthorUrl(author, f1, f2){
	return function(htmlString){
		var htmlEl = document.createElement("html");
		htmlEl.innerHTML = htmlString;
		var authorEls = cls(htmlEl, "authorName");
		for(var i=0; i<authorEls.length; i++){
			var authorEl = authorEls[i];
			if(authorEl.tagName == "A" && authorEl.innerText.toLowerCase() == author.toLowerCase()){
				var authorQuotesUrl = authorEl.href.split("?")[0].replace("show", "quotes"); //can be appended by "?page=2" etc.
				f1(authorQuotesUrl, f2);
				break;
			}
		}
	};
}

function getQuotes(){
	var inputAuthor = document.getElementById("inputAuthor").value
	var authorQueryUrl = "https://www.goodreads.com/search?query=" + inputAuthor.trim().replace(/ +/g, "+");
	loadXMLDoc(authorQueryUrl, getGoodreadsAuthorUrl(inputAuthor, loadXMLDoc, getGoodreadsQuotes));
}

function getImageUrls(htmlString){
	var htmlEl = document.createElement("html");
	htmlEl.innerHTML = htmlString;
	var aEls = tns(cl(htmlEl, "detail-links"), "a");
	var outputImages = el("images");
	for(var i=0; i<aEls.length; i++){
		var aEl = aEls[i];
		if(aEl.innerHTML == "Full-size image"){
			var image = document.createElement("img");
			image.setAttribute("src", aEl.href);
			image.setAttribute("onclick", "applyImage('" + aEl.href + "');");
			outputImages.appendChild(image);
		}
	}
}

function getCachedImageUrls(f1, f2){
	return function(htmlString){
		var htmlEl = document.createElement("html");
		htmlEl.innerHTML = htmlString;
		var imageEls = cls(htmlEl, "result");
		for(var i=0; i<imageEls.length; i++){
			var imageEl = imageEls[i];
			var cachedImageUrl = tn(imageEl, "a").href;
			f1(cachedImageUrl, f2);
		}
	};
}

function getImages(){
	var inputAuthor = document.getElementById("inputAuthor").value
	var authorQueryUrl = "https://picsearch.com/index.cgi?q=" + inputAuthor.trim().replace(/ +/g, "+");
	loadXMLDoc(authorQueryUrl, getCachedImageUrls(loadXMLDoc, getImageUrls));
}
</script>

</body>
</html>